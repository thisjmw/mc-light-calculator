(function(t){function e(e){for(var n,r,s=e[0],l=e[1],c=e[2],d=0,u=[];d<s.length;d++)r=s[d],Object.prototype.hasOwnProperty.call(o,r)&&o[r]&&u.push(o[r][0]),o[r]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(t[n]=l[n]);h&&h(e);while(u.length)u.shift()();return a.push.apply(a,c||[]),i()}function i(){for(var t,e=0;e<a.length;e++){for(var i=a[e],n=!0,s=1;s<i.length;s++){var l=i[s];0!==o[l]&&(n=!1)}n&&(a.splice(e--,1),t=r(r.s=i[0]))}return t}var n={},o={app:0},a=[];function r(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=n,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(i,n,function(e){return t[e]}.bind(null,n));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],l=s.push.bind(s);s.push=e,s=s.slice();for(var c=0;c<s.length;c++)e(s[c]);var h=l;a.push([0,"chunk-vendors"]),i()})({0:function(t,e,i){t.exports=i("56d7")},"034f":function(t,e,i){"use strict";var n=i("85ec"),o=i.n(n);o.a},"19bf":function(t,e,i){"use strict";var n=i("4e9c"),o=i.n(n);o.a},"292d":function(t,e,i){},"35de":function(t,e,i){},"444f":function(t,e,i){"use strict";var n=i("292d"),o=i.n(n);o.a},"4e9c":function(t,e,i){},"56d7":function(t,e,i){"use strict";i.r(e);i("e260"),i("e6cf"),i("cca6"),i("a79d");var n=i("2b0e"),o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"app"}},[i("div",{staticClass:"header no-select",on:{click:t.toggleControl}},[i("page-header",{attrs:{"show-controls":t.showControls}})],1),i("div",{staticClass:"content"},[i("light-calculator",{attrs:{"show-controls":t.showControls}})],1)])},a=[],r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"light-calculator"}},[i("view-grid-control-selector",{directives:[{name:"show",rawName:"v-show",value:t.showControls,expression:"showControls"}],on:{"change-control":t.changeControl,"change-view":t.changeView,"change-dimensions":t.changeDimensions,reset:t.reset}}),i("div",{staticClass:"view-grid-container"},[i("div",{class:{expanded:!t.showControls},attrs:{id:"view-grid"}},[i("view-grid",{attrs:{width:t.gridWidth,height:t.gridHeight,lights:t.lights,walls:t.walls,elevations:t.elevations,control:t.controlType,"grid-view":t.gridView},on:{"add-light":t.addLight,"remove-light":t.removeLight,"add-wall":t.addWall,"remove-wall":t.removeWall,"change-elevation":t.changeElevation,reset:t.reset}})],1)])],1)},s=[],l=(i("99af"),i("4de4"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"grid-container",style:t.gridLayout,on:{mouseleave:t.mouseLeft}},t._l(t.grid,(function(e,n){return i("div",{key:n,staticClass:"block no-select",class:t.blockStyle(e),on:{mousedown:function(e){return t.mouseDown(n)},mouseenter:function(e){t.dragging&&t.mouseEnter(n)},mouseup:t.mouseUp}},[t.gridView===t.gridViewEnum.LIGHT?[t._v(" "+t._s(e.type!==t.blockTypeEnum.WALL?e.strength:"")+" ")]:t.gridView===t.gridViewEnum.ELEVATION?[t._v(" "+t._s(e.elevation)+" ")]:t._e()],2)})),0)}),c=[],h=(i("0481"),i("c975"),i("4069"),i("a9e3"),i("ade3")),d=i("5530"),u=i("b85c"),g={NORMAL:1,LIGHT:2,WALL:3},v={LIGHT:1,ELEVATION:2},p={LIGHT:1,WALL:2,INCREASE_ELEVATION:3,DECREASE_ELEVATION:4},f={NONE:0,ADD_LIGHT:1,REMOVE_LIGHT:2,ADD_WALL:3,REMOVE_WALL:4,INCREASE_ELEVATION:5},m={name:"LightGrid",emits:["add-light","remove-light","add-wall","remove-wall","change-elevation"],props:{width:{type:Number,validator:function(t){return t>0}},height:{type:Number,validator:function(t){return t>0}},lights:Array,walls:Array,elevations:Object,control:Number,gridView:Number},data:function(){return{processed:0,updated:0,duplicated:0,blockTypeEnum:g,gridViewEnum:v,dragging:!1,dragHistory:[],dragBehavior:f.NONE}},computed:{grid:function(){for(var t=[],e=0;e<this.height;e++){t[e]=[];for(var i=0;i<this.width;i++){var n=this.elevations["".concat(i,",").concat(e)]||0;t[e][i]={strength:0,type:g.NORMAL,elevation:n}}}return this.gridView===v.LIGHT?this.calculateLighting(t):t.flat()},gridLayout:function(){return{gridTemplateColumns:"repeat(".concat(this.width,", 1.2rem)")}}},methods:{getEntityIndexMap:function(t){var e,i={},n=Object(u["a"])(this[t]);try{for(n.s();!(e=n.n()).done;){var o=e.value;i[this.coordinatesToIndex(o.x,o.y)]=o}}catch(a){n.e(a)}finally{n.f()}return i},calculateLighting:function(t){if(this.processed=0,this.updated=0,this.duplicated=0,!this.lights.length&&!this.walls.length)return t.flat();var e,i=[],n=Object(u["a"])(this.walls);try{for(n.s();!(e=n.n()).done;){var o=e.value;i.push(Object(d["a"])(Object(d["a"])({},o),{},{type:g.WALL}))}}catch(w){n.e(w)}finally{n.f()}var a,r=Object(u["a"])(this.lights);try{for(r.s();!(a=r.n()).done;){var s=a.value;i.push(Object(d["a"])(Object(d["a"])({},s),{},{type:g.LIGHT}))}}catch(w){r.e(w)}finally{r.f()}var l=i.shift();while(l){this.processed++;var c=l,h=c.x,v=c.y,p=c.type;if(l.elevation=t[v][h].elevation,p===g.WALL)this.updated++,t[v][h]=Object(d["a"])(Object(d["a"])({},t[v][h]),{},{type:p});else if(t[v][h].strength<l.strength){this.updated++;var f=l.strength;t[v][h]=Object(d["a"])(Object(d["a"])({},t[v][h]),{},{type:p,strength:f}),f>1&&(m(t,i,h,v-1,v>0,l),m(t,i,h+1,v,h<this.width-1,l),m(t,i,h,v+1,v<this.height-1,l),m(t,i,h-1,v,h>0,l))}else this.duplicated++;l=i.shift()}return t.flat();function m(t,e,i,n,o,a){if(o&&t[n][i].strength<a.strength-1){var r=t[n][i].elevation,s=Math.abs(r-a.elevation),l=a.strength-1-s;l>0&&l>t[n][i].strength&&e.push({x:i,y:n,elevation:r,strength:l,type:t[n][i].type})}}},clicked:function(t){var e,i=this.indexToCoordinates(t);switch(this.gridView){case v.LIGHT:var n=(e={},Object(h["a"])(e,p.LIGHT,{targetObjectExistsAtCoordinates:this.isBlockType(g.LIGHT,t),replaceableObjectExistsAtCoordinates:this.isBlockType(g.WALL,t),targetObjectName:"light",replaceableObjectName:"wall"}),Object(h["a"])(e,p.WALL,{targetObjectExistsAtCoordinates:this.isBlockType(g.WALL,t),replaceableObjectExistsAtCoordinates:this.isBlockType(g.LIGHT,t),targetObjectName:"wall",replaceableObjectName:"light"}),e),o=n[this.control];o.targetObjectExistsAtCoordinates?this.$emit("remove-".concat(o.targetObjectName),i):(o.replaceableObjectExistsAtCoordinates&&this.$emit("remove-".concat(o.replaceableObjectName),i),this.$emit("add-".concat(o.targetObjectName),i));break;case v.ELEVATION:this.$emit("change-elevation",i);break}},blockStyle:function(t){var e;switch(this.gridView){case v.LIGHT:var i="light-".concat(t.strength);return e={light:t.type===g.LIGHT},Object(h["a"])(e,i,t.type!==g.WALL),Object(h["a"])(e,"wall",t.type===g.WALL),Object(h["a"])(e,"danger",t.type!==g.WALL&&t.strength<8),e;case v.ELEVATION:var n="elevation-".concat(t.elevation>3?3:t.elevation);return Object(h["a"])({elevation:!0},n,!0)}},indexToCoordinates:function(t){var e=Math.floor(t/this.width),i=t-e*this.width,n=this.grid[t].elevation;return{x:i,y:e,elevation:n}},coordinatesToIndex:function(t,e){return t+e*this.width},isBlockType:function(t,e){var i,n=(i={},Object(h["a"])(i,g.LIGHT,"lights"),Object(h["a"])(i,g.WALL,"walls"),i),o=n[t];return!!o&&!!this.getEntityIndexMap(o)[e]},mouseDown:function(t){switch(this.dragging=!0,this.gridView){case v.LIGHT:switch(this.control){case p.LIGHT:this.isBlockType(g.LIGHT,t)?this.dragBehavior=f.REMOVE_LIGHT:this.dragBehavior=f.ADD_LIGHT;break;case p.WALL:this.isBlockType(g.WALL,t)?this.dragBehavior=f.REMOVE_WALL:this.dragBehavior=f.ADD_WALL;break}break;case v.ELEVATION:this.dragBehavior=f.INCREASE_ELEVATION;break}this.dragBehavior!==f.INCREASE_ELEVATION&&this.dragHistory.push(t),this.clicked(t)},mouseUp:function(){this.dragging=!1,this.dragHistory=[],this.dragBehavior=f.NONE},mouseEnter:function(t){if(this.dragBehavior===f.INCREASE_ELEVATION)this.clicked(t);else if(!~this.dragHistory.indexOf(t))switch(this.dragHistory.push(t),this.dragBehavior){case f.ADD_LIGHT:this.isBlockType(g.LIGHT,t)||this.clicked(t);break;case f.REMOVE_LIGHT:this.isBlockType(g.LIGHT,t)&&this.clicked(t);break;case f.ADD_WALL:this.isBlockType(g.WALL,t)||this.clicked(t);break;case f.REMOVE_WALL:this.isBlockType(g.WALL,t)&&this.clicked(t);break}},mouseLeft:function(){this.dragging&&this.mouseUp()}}},w=m,L=(i("444f"),i("2877")),E=Object(L["a"])(w,l,c,!1,null,"4d6db2de",null),b=E.exports,y=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"control-container"},[i("div",{staticClass:"container-row top"},[i("div",{staticClass:"container-col left"},[i("div",{staticClass:"control"},[i("label",{attrs:{for:"view-control"}},[t._v("View")]),i("select",{directives:[{name:"model",rawName:"v-model",value:t.gridView,expression:"gridView"}],attrs:{id:"view-control",required:!0},on:{change:function(e){var i=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.gridView=e.target.multiple?i:i[0]}}},t._l(t.viewOptions.options,(function(e){return i("option",{key:e.id,domProps:{value:e.value,selected:e.value===t.viewOptions.default}},[t._v(" "+t._s(e.name)+" ")])})),0)]),i("div",{staticClass:"control"},[i("label",{attrs:{for:"light-control"}},[t._v("Control")]),i("select",{directives:[{name:"model",rawName:"v-model",value:t.control,expression:"control"}],attrs:{id:"light-control",required:!0},on:{change:function(e){var i=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.control=e.target.multiple?i:i[0]}}},t._l(t.scopedControlOptions.options,(function(e){return i("option",{key:e.id,domProps:{value:e.value,selected:e.value===t.scopedControlOptions.default(t.gridView)}},[t._v(" "+t._s(e.name)+" ")])})),0)])]),i("div",{staticClass:"container-col right"},[i("div",{staticClass:"control"},[i("label",{attrs:{for:"height-control"}},[t._v("Height")]),i("input",{directives:[{name:"model",rawName:"v-model",value:t.height,expression:"height"}],attrs:{type:"number",id:"height-control",min:t.dimensions.height.min,max:t.dimensions.height.max},domProps:{value:t.height},on:{change:t.dimensionsChanged,input:function(e){e.target.composing||(t.height=e.target.value)}}})]),i("div",{staticClass:"control"},[i("label",{attrs:{for:"width-control"}},[t._v("Width")]),i("input",{directives:[{name:"model",rawName:"v-model",value:t.width,expression:"width"}],attrs:{type:"number",id:"width-control",min:t.dimensions.width.min,max:t.dimensions.width.max},domProps:{value:t.width},on:{change:t.dimensionsChanged,input:function(e){e.target.composing||(t.width=e.target.value)}}})])])]),i("div",{staticClass:"container-row bottom"},[i("button",{on:{click:t.reset}},[t._v("Reset")])])])},O=[];function T(t,e,i){return t<e?e:t>i?i:t}var A={default:v.LIGHT,options:[{id:"light-view",name:"Light",value:v.LIGHT},{id:"elevation-view",name:"Elevation",value:v.ELEVATION}]},C={default:function(t){switch(t){case v.LIGHT:return p.LIGHT;case v.ELEVATION:return p.INCREASE_ELEVATION}},options:[{id:"light-control",name:"Light",value:p.LIGHT,viewFilter:v.LIGHT},{id:"wall-control",name:"Wall",value:p.WALL,viewFilter:v.LIGHT},{id:"increase-elevation-control",name:"Increase Elevation",value:p.INCREASE_ELEVATION,viewFilter:v.ELEVATION},{id:"decrease-elevation-control",name:"Decrease Elevation",value:p.DECREASE_ELEVATION,viewFilter:v.ELEVATION}]},I={height:{default:40,min:1,max:100},width:{default:40,min:1,max:100}},_={name:"LightGridControlSelector",emits:["change-control","change-view","change-dimensions","reset"],data:function(){return{controlOptions:C,viewOptions:A,control:C.default(A.default),gridView:A.default,height:I.height.default,width:I.width.default,dimensions:I,blockTypeEnum:g,gridViewEnum:v}},computed:{scopedControlOptions:function(){var t=this;return{default:this.controlOptions.default,options:this.controlOptions.options.filter((function(e){return e.viewFilter===t.gridView}))}}},watch:{control:function(t){this.$emit("change-control",t)},gridView:function(t){this.viewChanged(),this.$emit("change-view",t)}},methods:{viewChanged:function(){this.control=C.default(this.gridView)},dimensionsChanged:function(){this.height=T(this.height,I.height.min,I.height.max),this.width=T(this.width,I.width.min,I.width.max),this.$emit("change-dimensions",{height:this.height,width:this.width})},reset:function(){this.height=I.height.default,this.width=I.width.default,this.gridView=A.default,this.viewChanged(),this.dimensionsChanged(),this.$emit("reset")}}},V=_,N=(i("19bf"),Object(L["a"])(V,y,O,!1,null,"652d667e",null)),x=N.exports,j=0,H=127,k={name:"LightCalculator",components:{ViewGrid:b,ViewGridControlSelector:x},props:{showControls:Boolean},data:function(){return{lights:[],walls:[],elevations:{},gridWidth:40,gridHeight:40,controlType:p.LIGHT,gridView:v.LIGHT}},methods:{addLight:function(t){this.lights.push({x:t.x,y:t.y,strength:14})},removeLight:function(t){this.lights=this.lights.filter((function(e){return!(e.x===t.x&&e.y===t.y)}))},addWall:function(t){this.walls.push({x:t.x,y:t.y})},removeWall:function(t){this.walls=this.walls.filter((function(e){return!(e.x===t.x&&e.y===t.y)}))},changeElevation:function(t){var e="".concat(t.x,",").concat(t.y);if(this.elevations[e]||this.controlType!==p.INCREASE_ELEVATION){var i=this.elevations[e];this.controlType===p.INCREASE_ELEVATION?this.$set(this.elevations,e,T(i+1,j,H)):this.controlType===p.DECREASE_ELEVATION&&this.$set(this.elevations,e,T(i-1,j,H))}else this.$set(this.elevations,e,1)},reset:function(){this.lights=[],this.walls=[],this.elevations={}},changeControl:function(t){this.controlType=t},changeView:function(t){this.gridView=t},changeDimensions:function(t){this.gridWidth=t.width,this.gridHeight=t.height}}},G=k,W=(i("ccd0"),Object(L["a"])(G,r,s,!1,null,"4f10b656",null)),B=W.exports,R=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"header"}},[i("div",{staticClass:"title"},[t._v("Light Calculator")]),i("div",{staticClass:"message"},[t._v(t._s(t.message))])])},S=[],D={name:"PageHeader",props:{showControls:Boolean},computed:{message:function(){return"(".concat(this.showControls?"hide":"show"," controls)")}}},$=D,M=(i("ad11"),Object(L["a"])($,R,S,!1,null,"29c4c6dd",null)),P=M.exports,F={name:"App",components:{PageHeader:P,LightCalculator:B},data:function(){return{showControls:!0}},methods:{toggleControl:function(){this.showControls=!this.showControls}}},U=F,q=(i("034f"),Object(L["a"])(U,o,a,!1,null,null,null)),J=q.exports;n["a"].config.productionTip=!1,new n["a"]({render:function(t){return t(J)}}).$mount("#app")},"85ec":function(t,e,i){},ad11:function(t,e,i){"use strict";var n=i("d244"),o=i.n(n);o.a},ccd0:function(t,e,i){"use strict";var n=i("35de"),o=i.n(n);o.a},d244:function(t,e,i){}});
//# sourceMappingURL=app.9c5be291.js.map